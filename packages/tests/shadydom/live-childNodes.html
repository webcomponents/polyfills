<!doctype html>
<!--
@license
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <meta charset="utf-8">

  <script src="../node_modules/@webcomponents/webcomponents-platform/webcomponents-platform.js"></script>
  <script>
    ShadyDOM = {force: true};
  </script>
  <script src="../node_modules/@webcomponents/shadydom/shadydom.min.js"></script>

  <script src="../node_modules/wct-browser-legacy/browser.js"></script>
</head>
<body>

<script>
'use strict';
suite('live childNodes consistency (issue 270)', function() {
  test('after child removal', function() {
    var a = document.createElement('a');
    var b = document.createElement('b');
     a.appendChild(b);
     var childNodes = a.childNodes;
    assert.equal(childNodes.length, 1);

    a.removeChild(b);
    assert.equal(a.childNodes.length, 0);
    assert.equal(childNodes.length, 0);
  });
  test('after child appended', function() {
    var node = document.createElement('a');
     var childNodes = node.childNodes;
    assert.equal(childNodes.length, 0);
     node.appendChild(document.createElement('b'));
    assert.equal(node.childNodes.length, 1);
    assert.equal(childNodes.length, 1);
  });
  test('after child inserted before', function() {
    var node = document.createElement('a');
    var child = document.createElement('b');

    node.appendChild(child);
     var childNodes = node.childNodes;
    assert.equal(childNodes.length, 1);
     var firstChild = document.createElement('c');
    node.insertBefore(firstChild, child);
    assert.equal(node.childNodes.length, 2);
    assert.equal(childNodes.length, 2);
    assert.equal(childNodes[0], node.childNodes[0]);
    assert.equal(childNodes[1], node.childNodes[1]);
    assert.equal(childNodes[0], firstChild);
    assert.equal(childNodes[1], child);
  });
  test('after textContent changed', function() {
    var node = document.createElement('a');
    var child = document.createElement('b');

    node.appendChild(child);
     var childNodes = node.childNodes;
    assert.equal(childNodes.length, 1);
    assert.equal(childNodes[0], child);
     node.textContent = 'text';
     assert.equal(node.childNodes.length, 1);
    assert.equal(childNodes.length, 1);
    assert.equal(node.childNodes[0], childNodes[0]);
    assert.notEqual(childNodes[0], child);
  });
  test('after innerHTML changed', function() {
    var node = document.createElement('a');
    var child = document.createElement('b');

    node.appendChild(child);
     var childNodes = node.childNodes;
    assert.equal(childNodes.length, 1);
    assert.equal(childNodes[0], child);
     node.innerHTML = '<span>test</span>';
     assert.equal(node.childNodes.length, 1);
    assert.equal(childNodes.length, 1);
    assert.equal(node.childNodes[0], childNodes[0]);
    assert.notEqual(childNodes[0], child);
  });
  test('after replaceChild', function() {
    var node = document.createElement('a');
    var child = document.createElement('b');

    node.appendChild(child);
     var childNodes = node.childNodes;
    assert.equal(childNodes.length, 1);
    assert.equal(childNodes[0], child);
     var newChild = document.createElement('c');
    node.replaceChild(newChild, child);
     assert.equal(node.childNodes.length, 1);
    assert.equal(childNodes.length, 1);
    assert.equal(node.childNodes[0], childNodes[0]);
    assert.notEqual(childNodes[0], child);
  });
});
</script>

</body>
</html>
